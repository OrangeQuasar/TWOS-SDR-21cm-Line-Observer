# TWOS-SDR-21cm-Line-Observer
このプログラムは、RTL-SDRを用いて天の川銀河などから放射される中性水素原子の21cm線（1420.4 MHz）を観測し、スペクトル強度をdB単位で表示・保存するツールです。
**このプログラムはWindows向けに作成されています。**
## 事前インストール
### python仮想環境を作成
```
python -m venv .venv
```
### 仮想環境にアクセス
```
.venv\Scripts\activate
```
実行権限に関するエラーが発生した場合は[こちら](https://orangequasar603.hatenablog.com/entry/2025/12/05/233653)を参照してください。
### 必要なライブラリのインストール
```
pip install -r requirements.txt
```
### 付属されている `zadig-2.9.exe` を実行してSDR用のドライバーを設定
- 初回のみ表示される画面では `continue` を選択してください。
- 起動したら `Install WCID Driver` をクリックします。
- 完了したら閉じます。

## プログラムを実行
```
python app_gui.py
```
### 必要情報の入力
- No (観測番号)、Source (天体名)、Duration (積分時間 [秒])を入力
- Simulation Mode (チェックボックス)は
    - ON (チェックあり): SDR機器を接続せずに動作テストを行うモードです。
    - OFF (チェックなし): 実際にSDR機器を使用して電波を観測するモードです。
### 上部ボタン
1. 準備 (Load計測): 基準となるノイズレベル（ベースライン）を測定します。
2. 観測開始 (Sky計測): 実際の天体を観測し、Loadデータとの差分からスペクトルを表示します。
3. クリア: 画面のグラフやエラーメッセージを消去します。
4. 終了: プログラムを閉じます。

これらのボタンを画面の指示に従って操作してください。
## 出力データについて
観測が完了すると、プログラムと同じ場所にある `data` フォルダ内に、以下の3種類のCSVファイルと画像が自動保存されます。

### 出力ファイル形式
ファイル名は `番号_天体名_種類_日時.csv` の形式になります。

| ファイル名の末尾 | 内容 | 解説 |
|--------|--------|--------|
| `_raw_...csv`   | 生データ (Sky)   | アンテナを繋いで受信したそのままのスペクトルデータです。   |
| `_load_...csv`   | 基準データ (Load)   | 「準備」ボタンを押した時に取得した、基準となるノイズデータです。   |
| `_spectrum_...csv`   | 解析結果 (dB)   | RawとLoadの比率を計算し、dBに変換した最終結果です。**このデータをExcel等でグラフ化してください。**   |
| `_plot_...png`   | グラフ画像   | 画面に表示されたグラフの画像ファイルです。   |

### CSVのフォーマット
1行目はヘッダー情報（周波数、強度、ゲイン値など）で、2行目以降がデータです。
- 1列目: 周波数 [MHz]
- 2列目: 強度 [dB または リニア値]

## 使用したドライバー
- [rtlsdr.dll](https://github.com/librtlsdr/librtlsdr/releases)
- [zadig-2.9.exe](https://zadig.akeo.ie/)